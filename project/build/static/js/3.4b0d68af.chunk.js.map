{"version":3,"sources":["components/cart-item/cart-item.jsx","components/cart/cart.jsx"],"names":["CartItem","item","onCountChange","itemsInCart","useSelector","getItemsInCart","dispatch","useDispatch","handleDeleting","setSelectedItem","setPopupDeletingStatus","document","addEventListener","evt","onEscKeyDown","className","type","onClick","srcSet","img","src","alt","width","height","toUpperCase","name","code","slice","stringNumber","price","toLocaleString","count","index","findIndex","itemInCart","setItemsInCart","Object","assign","reduce","accumulator","currentValue","elementIndex","Cart","useState","promocode","setPromocode","countTotal","setCountTotal","usedPromocodes","setUsedPromocodes","isPopupDeletingActive","getPopupDeletingStatus","ref","useRef","console","log","page","AppRoute","CART","href","to","map","value","method","action","onSubmit","preventDefault","length","Promocode","GITARAHIT","includes","SALE_PERCENT","SUPERGITARA","SALE_SUM","GITARA2020","SALE_PERCENT_LIMIT","htmlFor","id","onChange","target","current","setCustomValidity"],"mappings":"wOAQe,SAASA,EAAT,GAA0C,IAAvBC,EAAsB,EAAtBA,KAAMC,EAAgB,EAAhBA,cAChCC,EAAcC,YAAYC,KAC1BC,EAAWC,cAgCXC,EAAiB,WACrBF,EAASG,YAAgBR,IACzBK,EAASI,aAAuB,IAChCC,SAASC,iBAAiB,WAAW,SAACC,GAAD,OAASC,YAAaD,GAAK,kBAAMP,EAASI,aAAuB,WAGxG,OACE,qBAAIK,UAAU,kBAAd,UACE,wBACEA,UAAU,yBACVC,KAAK,SACL,aAAW,QACXC,QAAST,IAGX,oCACE,wBAAQQ,KAAK,aAAaE,OAAM,UAAKjB,EAAKkB,IAAV,WAChC,qBAAKJ,UAAU,mBAAmBK,IAAG,UAAKnB,EAAKkB,IAAV,QAAqBE,IAAI,uCAASC,MAAM,KAAKC,OAAO,WAG3F,sBAAMR,UAAU,mBAAhB,UACE,qBAAIA,UAAU,uBAAd,UAAsCd,EAAKe,KAAKQ,cAAhD,IAAgEvB,EAAKwB,KAAKD,iBAC1E,uBAAMT,UAAU,uBAAhB,yDAAiDd,EAAKyB,QACtD,uBAAMX,UAAU,8BAAhB,UACGd,EAAKe,KAAK,GAAGQ,cAAgBvB,EAAKe,KAAKW,MAAM,GADhD,KACsD1B,EAAK2B,aAD3D,0DAIF,uBAAMb,UAAU,wBAAhB,UAAyCd,EAAK4B,MAAMC,iBAApD,aAEA,qBAAIf,UAAU,sBAAd,UACE,oBAAIA,UAAU,qBAAd,SACE,wBACEA,UAAU,4BACVE,QA/DqB,WAC7B,GAAIhB,EAAK8B,MAAQ,EAAG,CAClB,IAAMC,EAAQ7B,EAAY8B,WAAU,SAACC,GAAD,OAAgBA,EAAWR,OAASzB,EAAKyB,QAC7EpB,EAAS6B,YAAe,GAAD,mBAClBhC,EAAYwB,MAAM,EAAGK,IADH,CAErBI,OAAOC,OAAO,GAAIpC,EAAM,CAAC8B,MAAO5B,EAAY6B,GAAOD,MAAQ,KAFtC,YAGlB5B,EAAYwB,MAAMK,EAAQ,OAE/B9B,EAAcC,EAAYmC,QAAO,SAACC,EAAaC,EAAcC,GAE3D,OAAOF,GADOE,IAAiBT,EAAQQ,EAAaT,MAAQ,EAAIS,EAAaT,OAChDS,EAAaX,QACzC,SAEHrB,KAgDI,iBAOF,oBAAIO,UAAU,qBAAd,SACE,wBAAQA,UAAU,4BAAlB,SAA+Cd,EAAK8B,UAEtD,oBAAIhB,UAAU,qBAAd,SACE,wBACEA,UAAU,4BACVE,QAzDoB,WAC5B,IAAMe,EAAQ7B,EAAY8B,WAAU,SAACC,GAAD,OAAgBA,EAAWR,OAASzB,EAAKyB,QAC7EpB,EAAS6B,YAAe,GAAD,mBAClBhC,EAAYwB,MAAM,EAAGK,IADH,CAErBI,OAAOC,OAAO,GAAIpC,EAAM,CAAC8B,MAAO5B,EAAY6B,GAAOD,MAAQ,KAFtC,YAGlB5B,EAAYwB,MAAMK,EAAQ,OAE/B9B,EAAcC,EAAYmC,QAAO,SAACC,EAAaC,EAAcC,GAE3D,OAAOF,GADOE,IAAiBT,EAAQQ,EAAaT,MAAQ,EAAIS,EAAaT,OAChDS,EAAaX,QACzC,KA6CG,oBASJ,uBAAMd,UAAU,mBAAhB,WAAqCd,EAAK4B,MAAQ5B,EAAK8B,OAAOD,iBAA9D,gB,mCCjFS,SAASY,IACtB,IAAMvC,EAAcC,YAAYC,KAChC,EAAkCsC,mBAAS,IAA3C,mBAAOC,EAAP,KAAkBC,EAAlB,KACA,EAAoCF,mBAASxC,EAAYmC,QAAO,SAACC,EAAaC,GAAd,OAA+BD,EAAcC,EAAaT,MAAQS,EAAaX,QAAO,IAAtJ,mBAAOiB,EAAP,KAAmBC,EAAnB,KACA,EAA4CJ,mBAAS,IAArD,mBAAOK,EAAP,KAAuBC,EAAvB,KACMC,EAAwB9C,YAAY+C,KACpCC,EAAMC,mBAEZC,QAAQC,IAAIpD,GAiDZ,OACE,qCACE,cAAC,IAAD,CAAQqD,KAAMC,IAASC,OACvB,sBAAM3C,UAAU,YAAhB,SACE,sBAAKA,UAAU,YAAf,UACE,oBAAIA,UAAU,kBAAd,oEACA,oBAAIA,UAAU,8BAAd,wDACA,qBAAIA,UAAU,YAAd,UACE,oBAAIA,UAAU,kBAAd,SACE,mBAAGA,UAAU,kBAAkB4C,KAAK,IAApC,0DAEF,oBAAI5C,UAAU,kBAAd,SACE,cAAC,IAAD,CAAMA,UAAU,kBAAkB6C,GAAG,IAArC,0DAEF,oBAAI7C,UAAU,kBAAd,uEAKF,oBAAIA,UAAU,YAAd,SACGZ,EAAY0D,KAAI,SAAC5D,GAAD,OAAU,cAACD,EAAD,CAA0BC,KAAMA,EAAMC,cAAe,SAAC4D,GAAD,OAAWf,EAAce,KAA/D7D,EAAKyB,WAGjD,sBAAKX,UAAU,gBAAf,UACE,sBAAKA,UAAU,2BAAf,UACE,oBAAIA,UAAU,uBAAd,gHACA,mBAAGA,UAAU,sBAAb,6NAEA,uBACEA,UAAU,sBACVgD,OAAO,OAAOC,OAAO,+BACrBvC,KAAK,iBACLwC,SA/EgB,SAACpD,GAE7B,GADAA,EAAIqD,iBACA/D,EAAYgE,OAAS,EAEvB,OADAb,QAAQC,IAAIX,GACLA,GACL,KAAKwB,IAAUC,UAAU5C,KAClBuB,EAAesB,SAASF,IAAUC,UAAU5C,QAC/CsB,EAAcD,IAAe,IAAMsB,IAAUC,UAAUE,cAAgB,MACvEtB,EAAkB,GAAD,mBAAKD,GAAL,CAAqBoB,IAAUC,UAAU5C,SAE5D,MACF,KAAK2C,IAAUI,YAAY/C,KACpBuB,EAAesB,SAASF,IAAUI,YAAY/C,QACjDsB,EAAcD,EAAasB,IAAUI,YAAYC,UACjDxB,EAAkB,GAAD,mBAAKD,GAAL,CAAqBoB,IAAUI,YAAY/C,SAE9D,MACF,KAAK2C,IAAUM,WAAWjD,KACnB2C,IAAUM,WAAWD,SAAW3B,EAAa,IAAOsB,IAAUM,WAAWC,qBAAuB3B,EAAesB,SAASF,IAAUM,WAAWjD,QAChJsB,EAAcD,EAAasB,IAAUM,WAAWD,UAChDxB,EAAkB,GAAD,mBAAKD,GAAL,CAAqBoB,IAAUM,WAAWjD,SAE7D,MACF,QACEsB,EAAcD,GAGpBD,EAAa,KAgDH,UAME,uBAAO9B,UAAU,4CAA4C6D,QAAQ,YAArE,8DACA,uBACE7D,UAAU,4BACVC,KAAK,OACL6D,GAAG,YACHf,MAAOlB,EACPkC,SAzDa,SAACjE,GAC5BgC,EAAahC,EAAIkE,OAAOjB,OACpBjD,EAAIkE,OAAOjB,SAASM,KAClBjE,EAAYgE,OAAS,EACvBf,EAAI4B,QAAQC,kBAAkB,IAE9B7B,EAAI4B,QAAQC,kBAAkB,mWAG5BjC,EAAesB,SAASzD,EAAIkE,OAAOjB,QACrCV,EAAI4B,QAAQC,kBAAkB,uLAGhC7B,EAAI4B,QAAQC,kBAAkB,2IA6ClB7B,IAAKA,IAEP,wBAAQrC,UAAU,6BAA6BC,KAAK,SAApD,yGAGJ,sBAAKD,UAAU,0BAAf,UACE,uBAAMA,UAAU,uBAAhB,6CAA+C+B,EAAWhB,iBAA1D,aACA,wBAAQf,UAAU,8BAAlB,wGAKR,cAAC,IAAD,CAAQyC,KAAMC,IAASC,OACtBR,GAAyB,cAAC,IAAD","file":"static/js/3.4b0d68af.chunk.js","sourcesContent":["import React, {useState} from 'react';\nimport PropTypes from 'prop-types';\nimport itemProp from '../props-validation/item.prop';\nimport {useDispatch, useSelector} from 'react-redux';\nimport {getItemsInCart} from '../../store/app-business-logic/selectors';\nimport {setPopupDeletingStatus, setSelectedItem, setItemsInCart} from '../../store/action';\nimport {onEscKeyDown} from '../../util';\n\nexport default function CartItem({item, onCountChange}) {\n  const itemsInCart = useSelector(getItemsInCart);\n  const dispatch = useDispatch();\n\n  const handleMinusButtonClick = () => {\n    if (item.count > 1) {\n      const index = itemsInCart.findIndex((itemInCart) => itemInCart.code === item.code);\n      dispatch(setItemsInCart([\n        ...itemsInCart.slice(0, index),\n        Object.assign({}, item, {count: itemsInCart[index].count - 1}),\n        ...itemsInCart.slice(index + 1)\n      ]));\n      onCountChange(itemsInCart.reduce((accumulator, currentValue, elementIndex) => {\n        const count = elementIndex === index ? currentValue.count - 1 : currentValue.count;\n        return accumulator + count * currentValue.price;\n      }, 0));\n    } else {\n      handleDeleting();\n    }\n  }\n\n  const handlePlusButtonClick = () => {\n    const index = itemsInCart.findIndex((itemInCart) => itemInCart.code === item.code);\n    dispatch(setItemsInCart([\n      ...itemsInCart.slice(0, index),\n      Object.assign({}, item, {count: itemsInCart[index].count + 1}),\n      ...itemsInCart.slice(index + 1)\n    ]));\n    onCountChange(itemsInCart.reduce((accumulator, currentValue, elementIndex) => {\n      const count = elementIndex === index ? currentValue.count + 1 : currentValue.count;\n      return accumulator + count * currentValue.price;\n    }, 0));\n  }\n\n  const handleDeleting = () => {\n    dispatch(setSelectedItem(item));\n    dispatch(setPopupDeletingStatus(true));\n    document.addEventListener('keydown', (evt) => onEscKeyDown(evt, () => dispatch(setPopupDeletingStatus(false))));\n  }\n\n  return (\n    <li className=\"cart-list__item\">\n      <button\n        className=\"cart-list__item-delete\"\n        type=\"button\"\n        aria-label=\"Close\"\n        onClick={handleDeleting}\n      >\n      </button>\n      <picture>\n        <source type=\"image/webp\" srcSet={`${item.img}.webp`}/>\n        <img className=\"cart-list__image\" src={`${item.img}.png`} alt=\"Гитара\" width=\"48\" height=\"124\"/>\n      </picture>\n\n      <div  className=\"cart-list__group\">\n        <h3 className=\"cart-list__item-name\">{item.type.toUpperCase()} {item.name.toUpperCase()}</h3>\n        <span className=\"cart-list__item-code\">Артикул: {item.code}</span>\n        <span className=\"cart-list__item-description\">\n          {item.type[0].toUpperCase() + item.type.slice(1)}, {item.stringNumber} струнная\n        </span>\n      </div>\n      <span className=\"cart-list__item-price\">{item.price.toLocaleString()} ₽</span>\n\n      <ul className=\"cart-list__controls\">\n        <li className=\"cart-list__control\">\n          <button\n            className=\"cart-list__control-button\"\n            onClick={handleMinusButtonClick}\n          >\n            -\n          </button>\n        </li>\n        <li className=\"cart-list__control\">\n          <button className=\"cart-list__control-button\">{item.count}</button>\n        </li>\n        <li className=\"cart-list__control\">\n          <button\n            className=\"cart-list__control-button\"\n            onClick={handlePlusButtonClick}\n          >\n            +\n          </button>\n        </li>\n      </ul>\n\n      <span className=\"cart-list__total\">{(item.price * item.count).toLocaleString()} ₽</span>\n    </li>\n  );\n}\n\nCartItem.propTypes = {\n  guitar: itemProp,\n  onCountChange: PropTypes.func.isRequired,\n}\n","import React, {useState, useRef} from 'react';\nimport {Link} from \"react-router-dom\";\nimport Header from '../header/header';\nimport CartItem from '../cart-item/cart-item';\nimport Footer from '../footer/footer';\nimport PopupDeleting from '../popup-deleting/popup-deleting';\nimport {AppRoute} from '../../const.js';\nimport {useSelector} from 'react-redux';\nimport {getPopupDeletingStatus} from '../../store/app-popup/selectors';\nimport {getItemsInCart} from '../../store/app-business-logic/selectors';\nimport {Promocode, SALE_PERCENT, SALE_SUM, SALE_GITARA2020_SUM} from '../../const';\n\nexport default function Cart() {\n  const itemsInCart = useSelector(getItemsInCart);\n  const [promocode, setPromocode] = useState('');\n  const [countTotal, setCountTotal] = useState(itemsInCart.reduce((accumulator, currentValue) => accumulator + currentValue.count * currentValue.price, 0));\n  const [usedPromocodes, setUsedPromocodes] = useState([]);\n  const isPopupDeletingActive = useSelector(getPopupDeletingStatus);\n  const ref = useRef();\n\n  console.log(itemsInCart);\n\n  const handlePromocodeSubmit = (evt) => {\n    evt.preventDefault();\n    if (itemsInCart.length > 0) {\n      console.log(promocode);\n      switch(promocode) {\n        case Promocode.GITARAHIT.name:\n          if (!usedPromocodes.includes(Promocode.GITARAHIT.name)) {\n            setCountTotal(countTotal * ((100 - Promocode.GITARAHIT.SALE_PERCENT) / 100));\n            setUsedPromocodes([...usedPromocodes, Promocode.GITARAHIT.name]);\n          }\n          break;\n        case Promocode.SUPERGITARA.name:\n          if (!usedPromocodes.includes(Promocode.SUPERGITARA.name)) {\n            setCountTotal(countTotal - Promocode.SUPERGITARA.SALE_SUM);\n            setUsedPromocodes([...usedPromocodes, Promocode.SUPERGITARA.name]);\n          }\n          break;\n        case Promocode.GITARA2020.name:\n          if ((Promocode.GITARA2020.SALE_SUM / countTotal * 100) < Promocode.GITARA2020.SALE_PERCENT_LIMIT && !usedPromocodes.includes(Promocode.GITARA2020.name)) {\n            setCountTotal(countTotal - Promocode.GITARA2020.SALE_SUM)\n            setUsedPromocodes([...usedPromocodes, Promocode.GITARA2020.name]);\n          }\n          break;\n        default:\n          setCountTotal(countTotal);\n      }\n    }\n    setPromocode('');\n  }\n\n  const handlePromocodeInput = (evt) => {\n    setPromocode(evt.target.value);\n    if (evt.target.value in Promocode) {\n      if (itemsInCart.length > 0) {\n        ref.current.setCustomValidity('');\n      } else {\n        ref.current.setCustomValidity('Промокоды не могут быть применены при отсутствии товаров в корзине');\n      }\n\n      if (usedPromocodes.includes(evt.target.value)) {\n        ref.current.setCustomValidity('Этот промокод уже был использован');\n      }\n    } else {\n      ref.current.setCustomValidity('Промокод не действителен');\n    }\n  }\n\n  return (\n    <>\n      <Header page={AppRoute.CART}/>\n      <main className=\"page-main\">\n        <div className=\"container\">\n          <h1 className=\"visually-hidden\">Магазин Guitar Shop</h1>\n          <h2 className=\"page-title page-title--cart\">Корзина</h2>\n          <ul className=\"page-path\">\n            <li className=\"page-path__item\">\n              <a className=\"page-path__link\" href=\"#\">Главная</a>\n            </li>\n            <li className=\"page-path__item\">\n              <Link className=\"page-path__link\" to=\"/\">Каталог</Link>\n            </li>\n            <li className=\"page-path__item\">\n              Оформляем\n            </li>\n          </ul>\n\n          <ul className=\"cart-list\">\n            {itemsInCart.map((item) => <CartItem key={item.code} item={item} onCountChange={(value) => setCountTotal(value)}/>)}\n          </ul>\n\n          <div className=\"cart-ordering\">\n            <div className=\"cart-ordering__promocode\">\n              <h4 className=\"cart-ordering__title\">Промокод на скидку</h4>\n              <p className=\"cart-ordering__text\">Введите свой промокод, если он у вас есть.</p>\n\n              <form\n                className=\"cart-ordering__form\"\n                method=\"post\" action=\"https://echo.htmlacademy.ru/\"\n                name=\"promocode-form\"\n                onSubmit={handlePromocodeSubmit}\n              >\n                <label className=\"cart-ordering__form-label visually-hidden\" htmlFor=\"promocode\">Промокод</label>\n                <input\n                  className=\"cart-ordering__form-input\"\n                  type=\"text\"\n                  id=\"promocode\"\n                  value={promocode}\n                  onChange={handlePromocodeInput}\n                  ref={ref}\n                />\n                <button className=\"cart-ordering__form-submit\" type=\"submit\">Применить купон</button>\n              </form>\n            </div>\n            <div className=\"cart-ordering__checkout\">\n              <span className=\"cart-ordering__total\">Всего: {countTotal.toLocaleString()} ₽</span>\n              <button className=\"cart-ordering__order-submit\">Оформить заказ</button>\n            </div>\n          </div>\n        </div>\n      </main>\n      <Footer page={AppRoute.CART}/>\n      {isPopupDeletingActive && <PopupDeleting />}\n    </>\n  );\n}\n"],"sourceRoot":""}